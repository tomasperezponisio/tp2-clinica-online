<!-- mis-turnos.component.html -->
<div class="container mt-4">
  <h3 class="mb-4 text-center">Mis Turnos</h3>

  <!-- Filter Input -->
  <div class="mb-3">
    <input
      type="text"
      class="form-control"
      [placeholder]="userRole === 'paciente' ? 'Filtrar por especialidad o especialista' : 'Filtrar por especialidad o paciente'"
      [(ngModel)]="filterText"
      (input)="onFilterChange()"
    />
  </div>

  <!-- Appointments Grid -->
  <div class="row">
    <div *ngFor="let turno of filteredTurnos" class="col-sm-6 col-md-4 col-lg-3 mb-3">
      <div class="card h-100">
        <div class="card-body d-flex flex-column">
          <h5 class="card-title">{{ turno.especialidad }}</h5>
          <p class="card-text">
            <ng-container *ngIf="userRole === 'paciente'">
              <strong>Especialista:</strong> {{ turno.especialistaNombre }}<br />
            </ng-container>
            <ng-container *ngIf="userRole === 'especialista'">
              <strong>Paciente:</strong> {{ turno.pacienteNombre }}<br />
            </ng-container>
            <strong>Fecha:</strong> {{ turno.fecha | date: 'fullDate' | titlecase }}<br />
            <strong>Hora:</strong> {{ turno.hora }}<br />
            <strong>Estado:</strong>
            <span [ngClass]="getEstadoClass(turno.estado)">
              {{ turno.estado | titlecase }}
            </span>
          </p>

          <!-- Actions -->
          <div class="mt-auto">
            <!-- Actions for Paciente -->
            <ng-container *ngIf="userRole === 'paciente'">
              <!-- Cancelar turno -->
              <button
                *ngIf="canCancelTurno(turno)"
                class="btn btn-danger btn-sm m-1"
                (click)="cancelarTurno(turno)"
              >
                Cancelar
              </button>

              <!-- Ver reseña -->
              <button
                *ngIf="canVerResena(turno)"
                class="btn btn-info btn-sm m-1"
                (click)="verResena(turno)"
              >
                Ver Reseña
              </button>

              <!-- Completar encuesta -->
              <button
                *ngIf="canCompletarEncuesta(turno)"
                class="btn btn-success btn-sm m-1"
                (click)="completarEncuesta(turno)"
              >
                Completar Encuesta
              </button>

              <!-- Calificar Atención -->
              <button
                *ngIf="canCalificarAtencion(turno)"
                class="btn btn-primary btn-sm m-1"
                (click)="calificarAtencion(turno)"
              >
                Calificar Atención
              </button>
            </ng-container>

            <!-- Actions for Especialista -->
            <ng-container *ngIf="userRole === 'especialista'">
              <!-- Cancelar turno -->
              <button
                *ngIf="canCancelarTurnoEsp(turno)"
                class="btn btn-danger btn-sm m-1"
                (click)="cancelarTurnoEsp(turno)"
              >
                Cancelar
              </button>

              <!-- Rechazar turno -->
              <button
                *ngIf="canRechazarTurno(turno)"
                class="btn btn-warning btn-sm m-1"
                (click)="rechazarTurno(turno)"
              >
                Rechazar
              </button>

              <!-- Aceptar turno -->
              <button
                *ngIf="canAceptarTurno(turno)"
                class="btn btn-success btn-sm m-1"
                (click)="aceptarTurno(turno)"
              >
                Aceptar
              </button>

              <!-- Finalizar turno -->
              <button
                *ngIf="canFinalizarTurno(turno)"
                class="btn btn-primary btn-sm m-1"
                (click)="finalizarTurno(turno)"
              >
                Finalizar
              </button>

              <!-- Ver reseña -->
              <button
                *ngIf="canVerResena(turno)"
                class="btn btn-info btn-sm m-1"
                (click)="verResena(turno)"
              >
                Ver Reseña
              </button>
            </ng-container>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
